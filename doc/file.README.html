<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; PropertyWebScraper Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="propertywebscraper">PropertyWebScraper</h1>

<p><a href="https://github.com/RealEstateWebTools/property_web_scraper/actions/workflows/ci.yml"><img src="https://github.com/RealEstateWebTools/property_web_scraper/actions/workflows/ci.yml/badge.svg" alt="CI"></a></p>

<p>Web based UI to make scraping data from real estate websites super simple.</p>

<h2 id="requirements">Requirements</h2>
<ul><li>
<p>Ruby &gt;= 3.1</p>
</li><li>
<p>Rails &gt;= 7.1</p>
</li><li>
<p>Google Cloud Firestore (or local emulator)</p>
</li></ul>

<h2 id="installation">Installation</h2>

<p>Install into an existing Rails project by adding this line to your application’s Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>property_web_scraper</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>git:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>https://github.com/RealEstateWebTools/property_web_scraper</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>branch:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>master</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Then execute:</p>

<pre class="code ruby"><code class="ruby">$ bundle
</code></pre>

<p>Set the required environment variables:</p>

<pre class="code ruby"><code class="ruby">export FIRESTORE_PROJECT_ID=your-gcp-project-id
# Production: path to your service account JSON key
export FIRESTORE_CREDENTIALS=/path/to/service-account.json
# Development/test: use the Firestore emulator instead
export FIRESTORE_EMULATOR_HOST=localhost:8080

# Optional: protect API endpoints with a shared key
export PROPERTY_SCRAPER_API_KEY=your-secret-api-key
</code></pre>

<p>Mount PropertyWebScraper by adding the following to your routes.rb file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mount'>mount</span> <span class='const'><span class='object_link'><a href="PropertyWebScraper.html" title="PropertyWebScraper (module)">PropertyWebScraper</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="PropertyWebScraper/Engine.html" title="PropertyWebScraper::Engine (class)">Engine</a></span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>Seed the initial scraper host data:</p>

<pre class="code ruby"><code class="ruby">rails property_web_scraper:db:seed
</code></pre>

<h2 id="development-setup">Development Setup</h2>

<p>Clone the repository and install dependencies:</p>

<pre class="code ruby"><code class="ruby">git clone https://github.com/RealEstateWebTools/property_web_scraper.git
cd property_web_scraper
bundle install
</code></pre>

<p>Start the Firestore emulator and seed data:</p>

<pre class="code ruby"><code class="ruby">firebase emulators:start --only firestore --project test-project &amp;
sleep 5
export FIRESTORE_EMULATOR_HOST=localhost:8080
export FIRESTORE_PROJECT_ID=test-project
bundle exec rails runner &quot;load &#39;db/seeds/import_hosts.rb&#39;&quot;
</code></pre>

<p>Run the test suite:</p>

<pre class="code ruby"><code class="ruby">firebase emulators:start --only firestore --project test-project &amp;
sleep 5
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec
</code></pre>

<h2 id="architecture-overview">Architecture Overview</h2>

<p><strong>Models:</strong></p>
<ul><li>
<p><code>Listing</code> – core model storing scraped property data (price, location, images, features)</p>
</li><li>
<p><code>ImportHost</code> – maps a website hostname to its scraper configuration</p>
</li><li>
<p><code>PwbListing</code> – extends Listing with PropertyWebBuilder-compatible JSON serialization</p>
</li><li>
<p><code>ScraperMapping</code> – loads JSON scraper configs from <code>config/scraper_mappings/</code> via ActiveHash</p>
</li></ul>

<p><strong>Services:</strong></p>
<ul><li>
<p><code>Scraper</code> – fetches an HTML page and extracts property fields using a ScraperMapping</p>
</li><li>
<p><code>ListingRetriever</code> – validates a URL, resolves the ImportHost, and delegates to Scraper</p>
</li><li>
<p><code>UrlValidator</code> – shared URL validation returning a result object with URI, ImportHost, and error info</p>
</li><li>
<p><code>ScrapedContentSanitizer</code> – strips HTML tags and blocks dangerous URI schemes before persistence</p>
</li></ul>

<p><strong>Controllers:</strong></p>
<ul><li>
<p><code>ApplicationController</code> – base controller providing <code>authenticate_api_key!</code> for API authentication</p>
</li><li>
<p><code>ScraperController</code> – welcome page, config endpoint, JSON retrieval, AJAX form handler</p>
</li><li>
<p><code>SinglePropertyViewController</code> – renders a single property page with map</p>
</li><li>
<p><code>Api::V1::ListingsController</code> – REST JSON endpoint returning PwbListing data</p>
</li></ul>

<p><strong>Config Mappings:</strong></p>

<p>JSON files in <code>config/scraper_mappings/</code> define CSS selectors, XPath expressions, and regex patterns for each supported website.</p>

<h2 id="api-endpoints">API Endpoints</h2>

<table role="table">
<thead>
<tr>
<th>Method</th>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/config/as_json</code></td>
<td>Returns scraper field configuration for realtor.com</td>
</tr>
<tr>
<td>GET/POST</td>
<td><code>/retriever/as_json</code></td>
<td>Scrapes a property URL and returns listing JSON</td>
</tr>
<tr>
<td>GET</td>
<td><code>/api/v1/listings?url=...</code></td>
<td>Returns a PwbListing-formatted JSON array</td>
</tr>
</tbody>
</table>

<p>All endpoints accept a <code>url</code> parameter and return JSON with a <code>success</code> boolean and either the listing data or an <code>error_message</code>.</p>

<h2 id="authentication">Authentication</h2>

<p>API endpoints can be protected with a shared API key. Set the <code>PROPERTY_SCRAPER_API_KEY</code> environment variable to enable authentication. When set, requests must include the key in one of:</p>
<ul><li>
<p><strong>Header:</strong> <code>X-Api-Key: your-secret-api-key</code></p>
</li><li>
<p><strong>Query parameter:</strong> <code>?api_key=your-secret-api-key</code></p>
</li></ul>

<p>If <code>PROPERTY_SCRAPER_API_KEY</code> is not set, authentication is skipped for backwards compatibility.</p>

<h2 id="data-sanitization">Data Sanitization</h2>

<p>All scraped content is automatically sanitized by <code>ScrapedContentSanitizer</code> before it is persisted via <code>Listing.update_from_hash</code>. The sanitizer strips HTML tags from text fields (title, description, address, etc.), rejects URLs with dangerous schemes (<code>javascript:</code>, <code>data:</code>), and converts protocol-relative URLs to HTTPS.</p>

<h2 id="running-tests">Running Tests</h2>

<p>Start the Firestore emulator before running any tests:</p>

<pre class="code ruby"><code class="ruby">firebase emulators:start --only firestore --project test-project &amp;
sleep 5
</code></pre>

<p>Then run specs with the emulator environment variables:</p>

<pre class="code ruby"><code class="ruby"># Full suite
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec

# Models only
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec spec/models

# Services only
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec spec/services

# Firestore library specs
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec spec/lib

# A single spec file
FIRESTORE_EMULATOR_HOST=localhost:8080 FIRESTORE_PROJECT_ID=test-project bundle exec rspec spec/models/property_web_scraper/listing_spec.rb
</code></pre>

<h2 id="contribute-and-spread-the-love">Contribute and spread the love</h2>

<p>We encourage you to contribute to this project and file issues for any problems you encounter.</p>

<p>If you like it, please star it and spread the word on <a href="https://twitter.com/prptywebbuilder">Twitter</a>, <a href="https://www.linkedin.com/company/propertywebbuilder">LinkedIn</a> and <a href="https://www.facebook.com/propertywebbuilder">Facebook</a>. You can also subscribe to GitHub notifications on this project.</p>

<p>Please consider making a contribution to the development of PropertyWebScraper. If you wish to pay for specific enhancements, please email me directly (opensource at propertywebbuilder.com).</p>
<hr>

<h2 id="license">License</h2>

<p>The gem is available as open source under the terms of the <a href="http://opensource.org/licenses/MIT">MIT License</a>.</p>

<h2 id="disclaimer">Disclaimer</h2>

<p>While scraping can sometimes be used as a legitimate way to access all kinds of data on the internet, it’s also important to consider the legal implications. There are cases where scraping data may be considered illegal, or open you to the possibility of being sued.</p>

<p>I created this tool in part as a learning exercise and am sharing it in case others find it useful. If you do decide to use this tool to scrape a website it is your responsibility to ensure that what you are doing is legal.</p>
</div></div>

      <div id="footer">
  Generated on Sun Feb 15 22:14:05 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.4.3).
</div>

    </div>
  </body>
</html>